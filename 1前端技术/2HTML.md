<h1 class="article-title no-number">HTML</h1>

# HTML5 æ–°å¢å†…å®¹

- æ–°è¯­ä¹‰åŒ–æ ‡ç­¾ï¼šheaderã€footerã€navã€sectionã€asideã€articleã€mainã€figure
- æ–°å¢ input ç±»å‹ï¼šcolorã€urlã€emailã€dateã€weekã€timeã€numberã€rangeã€searchã€tel
- æ–°å¢è¡¨å•æ§ä»¶å±æ€§ï¼šplaceholder/è®¾ç½®æ–‡æœ¬æ¡†é»˜è®¤æç¤ºæ–‡å­—ã€autofocus/è‡ªåŠ¨è·å¾—ç„¦ç‚¹ã€autocomplete/è”æƒ³å…³é”®è¯
- å­˜å‚¨ï¼šæä¾›äº† sessionStorageã€localStorage å’Œæœ¬åœ°ç¦»çº¿å­˜å‚¨ï¼ˆä½¿ç”¨ manifest é…ç½®æ–‡ä»¶ï¼‰
- å¤šåª’ä½“ï¼šéŸ³é¢‘å…ƒç´  audioã€è§†é¢‘å…ƒç´  vedioã€sourceã€embed
- åœ°ç†å®šä½ã€canvas ç”»å¸ƒã€æ‹–æ”¾ APIã€å¤šçº¿ç¨‹ç¼–ç¨‹çš„ webworkerã€websocket åè®®

# Doctype

Doctype å£°æ˜åœ¨æ–‡æ¡£çš„æœ€å‰é¢ï¼Œå‘Šè¯‰æµè§ˆå™¨ä»¥å“ªç§æ–¹å¼æ¥æ¸²æŸ“é¡µé¢ï¼š

ä¸¥æ ¼æ¨¡å¼ï¼šæ’ç‰ˆå’Œ JS è¿ä½œæ¨¡å¼æ˜¯ä»¥è¯¥æµè§ˆå™¨æ”¯æŒçš„æœ€é«˜æ ‡å‡†è¿è¡Œçš„
æ··æ‚æ¨¡å¼ï¼šå‘åå…¼å®¹ï¼Œæ¨¡æ‹Ÿè€å¼æµè§ˆå™¨ï¼Œé˜²æ­¢æµè§ˆå™¨æ— æ³•å…¼å®¹é¡µé¢

# HTTP

HTTP æ˜¯ä¸€ä¸ªç®€å•çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®ƒé€šå¸¸è¿è¡Œåœ¨ TCP ä¹‹ä¸Šã€‚å®ƒæŒ‡å®šäº†å®¢æˆ·ç«¯å¯èƒ½å‘é€ç»™æœåŠ¡å™¨ä»€ä¹ˆæ ·çš„æ¶ˆæ¯ä»¥åŠå¾—åˆ°ä»€ä¹ˆæ ·çš„å“åº”ã€‚

**HTTP æ˜¯ä¸€ä¸ªåŸºäº TCP/IP é€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®ï¼ˆHTML æ–‡ä»¶, å›¾ç‰‡æ–‡ä»¶, æŸ¥è¯¢ç»“æœç­‰ï¼‰ã€‚**

![image-20210422160040476](assets/image-20210422160040476.png)

## ç‰¹ç‚¹

- **æ”¯æŒ C/S æ¨¡å¼**ã€‚
- **ç®€å•å¿«é€Ÿ**ï¼šHTTP åè®®ç®€å•ï¼Œè¯·æ±‚åªéœ€è¦ Method å’Œ URIï¼Œç¨‹åºè§„æ¨¡å°ï¼Œé€šä¿¡é€Ÿåº¦å¿«ã€‚
- **çµæ´»**ï¼šå…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®ã€‚æ­£åœ¨ä¼ è¾“çš„ç±»å‹ç”±`Content-Type`åŠ ä»¥æ ‡è®°ã€‚
- **æ— è¿æ¥**ï¼šæ— è¿æ¥çš„å«ä¹‰æ˜¯é™åˆ¶æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åï¼Œå®¢æˆ·ç«¯åº”ç­”åï¼Œå³æ–­å¼€è¿æ¥ã€‚å¦‚æœéœ€è¦é•¿è¿æ¥ï¼Œé€šè¿‡`Connection: Keep-Alive`å®ç°ã€‚
- **æ— çŠ¶æ€**ï¼šæ— çŠ¶æ€æŒ‡å¯¹äº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ã€‚

## URI & URL

### URI

URIï¼Œæ˜¯ uniform resource identifierï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼Œç”¨æ¥å”¯ä¸€çš„æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚

HTTP ä½¿ç”¨ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆUniform Resource Identifiers, URIï¼‰æ¥ä¼ è¾“æ•°æ®å’Œå»ºç«‹è¿æ¥ã€‚

Web ä¸Šå¯ç”¨çš„æ¯ç§èµ„æºå¦‚ HTML æ–‡æ¡£ã€å›¾åƒã€è§†é¢‘ç‰‡æ®µã€ç¨‹åºç­‰éƒ½æ˜¯ä¸€ä¸ªæ¥ URI æ¥å®šä½çš„ã€‚

### URL

URL æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„ URIï¼ŒåŒ…å«äº†ç”¨äºæŸ¥æ‰¾æŸä¸ªèµ„æºçš„è¶³å¤Ÿçš„ä¿¡æ¯ã€‚

## è¯·æ±‚ & å“åº”

### Request è¯·æ±‚

å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ°æœåŠ¡å™¨çš„è¯·æ±‚æ¶ˆæ¯åŒ…æ‹¬ä»¥ä¸‹æ ¼å¼ï¼š**è¯·æ±‚çŠ¶æ€è¡Œ**ã€**è¯·æ±‚å¤´éƒ¨**ã€**ç©ºè¡Œ**ã€**è¯·æ±‚æ­£æ–‡**å››ä¸ªéƒ¨åˆ†ç»„æˆã€‚

### Response å“åº”

å½“ä½ å‘å¯¹æ–¹å‘é€è¯·æ±‚åï¼Œå¯¹æ–¹ä¼šå›åº”ä½ æµè§ˆå™¨çš„è¯·æ±‚ï¼Œè¿”å›ä¸¤ä¸ªéƒ¨åˆ†ï¼š**å“åº”çŠ¶æ€è¡Œ**ã€**æ¶ˆæ¯æŠ¥å¤´**ï¼Œ**å“åº”æ­£æ–‡**ä¸‰éƒ¨åˆ†ã€‚

## HTTP çŠ¶æ€ç 

HTTP çŠ¶æ€ç ç”±ä¸‰ä¸ªåè¿›åˆ¶æ•°å­—ç»„æˆï¼Œç¬¬ä¸€ä¸ªåè¿›åˆ¶æ•°å­—å®šä¹‰äº†çŠ¶æ€ç çš„ç±»å‹ï¼Œåä¸¤ä¸ªæ•°å­—æ²¡æœ‰åˆ†ç±»çš„ä½œç”¨ã€‚HTTP çŠ¶æ€ç å…±åˆ†ä¸º 5 ç§ç±»å‹ï¼š

| åˆ†ç±»  | æè¿°                                           |
| ----- | ---------------------------------------------- |
| 1\*\* | ä¿¡æ¯ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œéœ€è¦è¯·æ±‚è€…ç»§ç»­æ‰§è¡Œæ“ä½œ   |
| 2\*\* | æˆåŠŸï¼Œæ“ä½œè¢«æˆåŠŸæ¥æ”¶å¹¶å¤„ç†                     |
| 3\*\* | é‡å®šå‘ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„æ“ä½œä»¥å®Œæˆè¯·æ±‚             |
| 4\*\* | å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚åŒ…å«è¯­æ³•é”™è¯¯æˆ–æ— æ³•å®Œæˆè¯·æ±‚     |
| 5\*\* | æœåŠ¡å™¨é”™è¯¯ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ |

## æ‰‹æ’¸å®ç° Ajax åŠŸèƒ½

æˆ‘ä»¬å¸¸ç”¨çš„ Ajax å°±æ˜¯é€šè¿‡ **XMLHttpRequest** å¯¹è±¡å®ç°çš„ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„å±æ€§å’Œäº‹ä»¶ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå°†å®ƒå®ä¾‹åŒ–ã€‚

1. åˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯ã€‚

   ```js
   const http = require('http');

   // http server ä¾‹å­
   const server = http.createServer((req, res) => {
     res.setHeader('Access-Control-Allow-Origin', '*');
     res.end('Hello Client!');
   });

   // ç›‘å¬ç«¯å£
   server.listen(3008, () => {
     console.log(`* ğŸš€ http://127.0.0.1:3008/ æœåŠ¡å¯åŠ¨æˆåŠŸ!`);
   });
   ```

2. åˆ›å»º HTML æ–‡ä»¶ï¼Œå¹¶ç”¨æµè§ˆå™¨è¿è¡Œã€‚

   ```html
   <!DOCTYPE html>
   <html>
     <head>
       <meta charset="utf-8" />
       <script type="text/javascript">
         function HTTPTest() {
           if ('XMLHttpRequest' in window) {
             alert('æ‚¨çš„æµè§ˆå™¨æ”¯æŒ XMLHttpRequest!');
             // åˆ›å»ºajaxå¯¹è±¡å¹¶å®ä¾‹åŒ–
             var xhr = new XMLHttpRequest();
             // è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€
             xhr.open('POST', 'http://127.0.0.1:3008');
             // readystateæ˜¯xhrå¯¹è±¡ä¸­çš„å±æ€§ï¼Œç”¨æ¥è·å–ajaxçŠ¶æ€ç  0 1 2 3 4
             xhr.onreadystatechange = function () {
               // åˆ¤æ–­ajaxçŠ¶æ€ç 
               // statusè·å–httpçŠ¶æ€ç ã€‚200è¡¨ç¤ºok
               if (xhr.readyState === 4 && xhr.status === 200) {
                 // xhr.responseTextè¡¨ç¤ºè¯·æ±‚è¿”å›çš„æ•°æ®å†…å®¹
                 console.log(xhr.responseText);
               }
             };
             // å‘é€
             xhr.send('Hello Server!');
           } else {
             // æµè§ˆå™¨ä¸æ”¯æŒ XMLHttpRequest
             alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ XMLHttpRequest!');
           }
         }
       </script>
     </head>
     <body>
       <div id="sse">
         <a href="javascript:HTTPTest()">è¿è¡Œ HTTP</a>
       </div>
     </body>
   </html>
   ```

# WebSocket

WebSocket æ˜¯ HTML5 ä¸­æ–°å¢çš„åè®®ï¼Œæ”¯æŒæŒä¹…æ€§è¿æ¥ï¼Œè§£å†³äº† HTTP åè®®é€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·çš„ç¼ºé™·ã€‚**WebSocket å…è®¸æœåŠ¡å™¨ç«¯ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚**

## ç‰¹ç‚¹

- æœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œå®ç°äº†åŒå‘å¹³ç­‰å¯¹è¯
- å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼ŒæœåŠ¡ç«¯çš„å®ç°æ¯”è¾ƒå®¹æ˜“
- ä¸ HTTP åè®®æœ‰ç€è‰¯å¥½çš„å…¼å®¹æ€§ã€‚é»˜è®¤ç«¯å£ä¹Ÿæ˜¯ 80 å’Œ 443ï¼Œæ¡æ‰‹é˜¶æ®µé‡‡ç”¨ HTTP åè®®ï¼Œå› æ­¤ä¸å®¹æ˜“å±è”½ï¼Œä¸”èƒ½é€šè¿‡å„ç§ HTTP ä»£ç†æœåŠ¡å™¨
- æ•°æ®æ ¼å¼ï¼ˆå¸§ï¼‰æ¯”è¾ƒè½»é‡ï¼Œæ€§èƒ½å¼€é”€å°ï¼Œé€šä¿¡æ•ˆç‡é«˜
- å¯ä»¥å‘é€æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®
- æ— åŒæºé™åˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ä»»æ„æœåŠ¡å™¨é€šä¿¡
- åè®®æ ‡è¯†ç¬¦æ˜¯ wsï¼ˆåŠ å¯†åˆ™ä¸º wssï¼‰ï¼ŒæœåŠ¡å™¨ç½‘å€å°±æ˜¯ URL

## å»ºç«‹ WebSocket è¿æ¥

å®¢æˆ·ç«¯é€šè¿‡ HTTP è¯·æ±‚ä¸ WebSocket æœåŠ¡ç«¯åå•†å‡çº§åè®®ï¼Œåè®®å‡çº§å®Œæˆåï¼Œåç»­çš„æ•°æ®äº¤æ¢éµç…§ WebSocket çš„åè®®ã€‚

1. å®¢æˆ·ç«¯ç”³è¯·åè®®å‡çº§ï¼Œé‡‡ç”¨æ ‡å‡† HTTP æŠ¥æ–‡æ ¼å¼ï¼Œä¸”åªæ”¯æŒ GET æ–¹æ³•

   è¯·æ±‚é¦–éƒ¨ï¼š

   Connection: Upgrade è¡¨ç¤ºè¦å‡çº§åè®®

   Upgrade: websocket è¡¨ç¤ºè¦å‡çº§åˆ° websocket åè®®

   Sec-WebSocket-Version è¡¨ç¤º websocket ç‰ˆæœ¬

   Sec-WebSocket-Key ä¸åç»­æœåŠ¡ç«¯å“åº”é¦–éƒ¨ Sec-WebSocket-Accept é…å¥—ï¼Œæä¾›åŸºæœ¬çš„é˜²æŠ¤ï¼Œå¦‚æ¶æ„çš„è¿æ¥æˆ–æ— æ„çš„è¿æ¥

2. æœåŠ¡ç«¯å“åº”åè®®å‡çº§ï¼Œè¿”å›å¦‚ä¸‹å†…å®¹ï¼ŒçŠ¶æ€ä»£ç  101 è¡¨ç¤ºåè®®åˆ‡æ¢ã€‚è‡³æ­¤å®Œæˆåè®®å‡çº§ï¼Œåç»­çš„æ•°æ®äº¤äº’éƒ½æŒ‰ç…§æ–°åè®®æ¥

   Connection: Upgrade

   Upgrade: websocket

   Sec-WebSocket-Accept æ ¹æ® Sec-WebSocket-Key è®¡ç®—

**å¦‚ä¸‹æ˜¯ Chrome æµè§ˆå™¨è¯·æ±‚ Websocket è¿æ¥çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯ã€‚**

![image-20210422155242692](assets/image-20210422155242692.png)

## æ‰‹æ’¸å®ç° WebSocket

1. åç«¯å®ç°ä¸€ä¸ª WebSocket æœåŠ¡ã€‚

   ```js
   const WebSocket = require('ws');
   //åˆ›å»ºä¸€ä¸ªWebSocketServerçš„å®ä¾‹
   const host = 'localhost';
   const port = 9998;
   const wss = new WebSocket.Server(
     {
       host,
       port,
     },
     () => {
       console.log(`* ğŸš€ ws://${host}:${port} æœåŠ¡å¯åŠ¨æˆåŠŸ!`);
     }
   );

   wss.on('connection', (clientSock) => {
     // ç›‘å¬å¿ƒè·³
     clientSock.on('pong', () => {
       clientSock.isAlive = true;
     });
     // æ¥æ”¶åˆ°æ•°æ®
     clientSock.on('message', (message) => {
       console.log(`received: ${message}`);
       clientSock.send('Hi Client');
     });
     // é€šä¿¡å‘ç”Ÿé”™è¯¯
     clientSock.on('error', (err) => {
       console.log(`è¿æ¥å¤±è´¥, ${err.message}`);
     });
     // å®¢æˆ·ç«¯è¿æ¥å…³é—­æ—¶è§¦å‘
     clientSock.on('close', () => {
       console.log(`Bye.`);
     });
   });
   ```

2. æ‰“å¼€ Chrome æ§åˆ¶å°ï¼Œåˆ›å»º WebSocket å¯¹è±¡ï¼Œå¹¶ send æ•°æ®ã€‚

   ```js
   // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ WebSocket
   'WebSocket' in window;
   // åˆ›å»º WebSocket å¯¹è±¡
   const ws = new WebSocket('ws://localhost:9998');
   // å‘é€æ•°æ®
   ws.send('ä½ å¥½ï¼ŒæœåŠ¡ç«¯ï¼');
   // å…³é—­
   ws.close();
   ```

3. æ‰“å¼€æµè§ˆå™¨çš„æ§åˆ¶å°ï¼Œå¯ä»¥æŸ¥çœ‹ Networkï¼Œå¯ä»¥çœ‹åˆ°å‘é€å’Œæ”¶åˆ°çš„æ¶ˆæ¯ã€‚

   ![image-20210422154423896](assets/image-20210422154423896.png)
